import{r as c,a as S,e as w,u as E,h as v,x as L,d as f,j as e,B as C,t as x}from"./index-DQRqkN2p.js";import{F as k,a as _,b as l}from"./formik.esm-DUt3CO4w.js";import{B}from"./Banner-Bj7N0vlL.js";import{b as j,a as R}from"./banner-dashboard-products-mobile-JLjYs1l0.js";import{i as p}from"./placeholder-ice-cream-CrNkbAc3.js";var M={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const z=M.VITE_IMAGE_KEY,V=()=>{const[y,u]=c.useState(j),{selectedItem:s,loading:b,error:A}=S(t=>t.stockItems),[a,P]=c.useState(null),[q,d]=c.useState(p),g=w(),o=E(),{id:m}=v();c.useEffect(()=>(m&&o(L(m)),()=>{o(f())}),[m,o]),c.useEffect(()=>{s&&(P(s),d(s.image?`${z}/${s.image}`:p))},[s]),c.useEffect(()=>{const t=()=>{window.innerWidth<=430?u(j):u(R)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const N=t=>{t.preventDefault(),o(f()),g("/dashboard/stock")},U=(t,i)=>{const r=t.currentTarget.files[0];if(r){const n=new FileReader;n.onloadend=()=>{d(n.result),i("image",r)},n.readAsDataURL(r)}else d(p)},F=async t=>{const i=new FormData;i.append("title",t.title),i.append("category",t.category),i.append("description",t.description),i.append("quantity",t.quantity),i.append("pricePerUnit",t.pricePerUnit),i.append("status",t.status),i.append("image",t.image);try{await o(C({id:s._id,updatedItem:i})).unwrap(),x.success("Article modifié avec succès !"),g("/dashboard/stock")}catch{x.error("Échec de modification de l'article.")}};return b||!a?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"main",children:[e.jsx(B,{image:y,title:"Modifiez l'article",textColor:"white",textPosition:"left"}),e.jsx("section",{className:"modify-stock-item",children:e.jsxs("div",{className:"add-stock-item-form-wrapper",children:[e.jsx("div",{className:"add-stock-item-form-image",children:e.jsx("img",{src:q,alt:"Stock Item"})}),e.jsx(k,{initialValues:{title:(a==null?void 0:a.title)||"",category:(a==null?void 0:a.category)||"",description:(a==null?void 0:a.description)||"",quantity:(a==null?void 0:a.quantity)||0,pricePerUnit:(a==null?void 0:a.pricePerUnit)||0,status:(a==null?void 0:a.status)||"",image:(a==null?void 0:a.image)||""},onSubmit:F,validate:t=>{const i={};return t.title||(i.title="Le nom est requis"),t.category||(i.category="La catégorie est requise"),t.description||(i.description="La description est requise"),(!t.image||!(t.image instanceof File))&&(i.image="Veuillez télécharger une image."),!t.quantity||t.quantity===0?i.quantity="La quantité est requise":t.quantity<0&&(i.quantity="La quantité ne peut pas être négative"),!t.pricePerUnit||t.pricePerUnit===0?i.pricePerUnit="Le prix est requis":t.pricePerUnit<0&&(i.pricePerUnit="Le prix ne peut pas être négatif"),i},children:({values:t,errors:i,touched:r,setFieldValue:n})=>e.jsxs(_,{className:"add-stock-item-form",children:[e.jsx("label",{htmlFor:"title",children:"Nom de la glace"}),e.jsx("div",{className:"add-stock-item-input",children:e.jsx(l,{name:"title",type:"text",placeholder:"Nom de la glace"})}),i.title&&r.title&&e.jsx("p",{className:"form-error",children:i.title}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",children:"Catégorie de la glace"}),e.jsxs(l,{as:"select",name:"category",id:"option",required:!0,children:[e.jsx("option",{value:"Crème",label:"Crème"}),e.jsx("option",{value:"Fruits",label:"Fruits"}),e.jsx("option",{value:"Fruits rouges",label:"Fruits rouges"}),e.jsx("option",{value:"Noix",label:"Noix"})]})]}),i.category&&r.category&&e.jsx("p",{className:"form-error",children:i.category}),e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("div",{className:"add-stock-item-input",children:e.jsx(l,{name:"description",as:"textarea",placeholder:"Description"})}),i.description&&r.description&&e.jsx("p",{className:"form-error",children:i.description}),e.jsx("label",{htmlFor:"image",children:"Image"}),e.jsx("div",{className:"add-stock-item-input",children:e.jsx("input",{name:"image",type:"file",accept:"image/*",onChange:h=>{U(h,n),n("image",h.currentTarget.files[0])},onBlur:()=>n("touched.image",!0)})}),i.image&&r.image&&e.jsx("p",{className:"form-error",children:i.image}),e.jsx("label",{htmlFor:"quantity",children:"Quantité"}),e.jsx("div",{className:"add-stock-item-input",children:e.jsx(l,{name:"quantity",type:"number",min:"0",placeholder:"Quantité"})}),i.quantity&&r.quantity&&e.jsx("p",{className:"form-error",children:i.quantity}),e.jsx("label",{htmlFor:"pricePerUnit",children:"Prix"}),e.jsx("div",{className:"add-stock-item-input",children:e.jsx(l,{name:"pricePerUnit",type:"number",min:"0",placeholder:"Prix"})}),i.pricePerUnit&&r.pricePerUnit&&e.jsx("p",{className:"form-error",children:i.pricePerUnit}),e.jsxs("div",{className:"add-stock-item-form-buttons",children:[e.jsx("button",{onClick:N,children:"Annuler"}),e.jsx("button",{type:"submit",children:"Modifier"})]})]})})]})})]})};export{V as default};
